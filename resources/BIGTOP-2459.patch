From 9991ee3600db54fc15ea51c7f88de769086d8334 Mon Sep 17 00:00:00 2001
From: Cory Johns <johnsca@gmail.com>
Date: Thu, 26 May 2016 15:47:33 -0400
Subject: [PATCH] BIGTOP-2459: Add option to disable vmem check for NodeManager

---
 bigtop-deploy/puppet/modules/hadoop/manifests/init.pp       | 1 +
 bigtop-deploy/puppet/modules/hadoop/templates/yarn-site.xml | 5 +++++
 2 files changed, 6 insertions(+)

diff --git a/bigtop-deploy/puppet/modules/hadoop/manifests/init.pp b/bigtop-deploy/puppet/modules/hadoop/manifests/init.pp
index 90c9505..3511429 100644
--- a/bigtop-deploy/puppet/modules/hadoop/manifests/init.pp
+++ b/bigtop-deploy/puppet/modules/hadoop/manifests/init.pp
@@ -151,6 +151,7 @@ class hadoop ($hadoop_security_authentication = "simple",
       $container_executor_min_user_id = "499",
       $hadoop_security_authentication = $hadoop::hadoop_security_authentication,
       $kerberos_realm = $hadoop::kerberos_realm,
+      $yarn_nodemanager_vmem_check_enabled = hiera("bigtop::yarn_nodemanager_vmem_check", true),
   ) inherits hadoop {
 
     include common
diff --git a/bigtop-deploy/puppet/modules/hadoop/templates/yarn-site.xml b/bigtop-deploy/puppet/modules/hadoop/templates/yarn-site.xml
index 054ae65..12b3e56 100644
--- a/bigtop-deploy/puppet/modules/hadoop/templates/yarn-site.xml
+++ b/bigtop-deploy/puppet/modules/hadoop/templates/yarn-site.xml
@@ -175,6 +175,11 @@
   </property>
 
   <property>
+    <name>yarn.nodemanager.vmem-check-enabled</name>
+    <value><%= @yarn_nodemanager_vmem_check_enabled %></value>
+  </property>
+
+  <property>
     <description>Classpath for typical applications.</description>
      <name>yarn.application.classpath</name>
      <value>
-- 
1.9.1

